# AsciiDoc - простота Markdown с функциями DITA

Всем привет! Меня зовут Владимир, но вы можете звать меня Грибнорий, потому что я люблю грибы. Но рассказывать я буду про любовь к AsciiDoc. Когда я только пришёл в Docsvision, основным инструментом документации у нас была DITA. Но потом мы решили модернизировать документацию, чтобы была разбивка на версии, чтобы всё было в онлайне и т.д. и т.п. Подробнее можно прочитать в моих предыдущих статьях:

- [Мой путь в IT, как я попал в Docsvision](ПОКА НЕ ОПУБЛИКОВАНО)
- [Про выбор и причины нового инструмента документации](https://habr.com/ru/post/589457/)
- [Про перенос документации из DITA в AsciiDoc+Antora](https://habr.com/ru/post/592477/)
- [Сравнение возможностей DITA и AsciiDoc](https://habr.com/ru/post/657977/)

Поначалу переход на AsciiDoc был прыжком в неизвестность. У меня было совсем немного опыта работы с этим языком разметки, я не знал всех тех удобных приёмов, которые выделяют его на фоне других языков разметки. Сейчас, спустя более чем год работы с AsciiDoc, я узнал много интересных приёмов, которыми хочу поделиться в этой статье. Возможно, прочтение этого материала поможет кому-то определиться с инструментом технической документации.

## Атрибуты 

Атрибуты - одна из самых простых, но сильных функций AsciiDoc. 
Это простой инструмент повторного использования, который позволяет, например, заменить повторяющееся слово по всему документу:

`"На сайте {habr} можно нати много статей по теме технической документации"`

В примере выше `{habr}` - атрибут AsciiDoc, в котором может быть записан адрес сайта в интернете вот так: `habr: https://habr.com/`

Атрибут может быть задан в главном файле и будет доступен во всех подчинённых и включённых.

## Заимствования

Заимствования позволяют сократить количество повторов и облегчают контроль за изменениями. Проще говоря, пишем один раз, добавляем ссылку в пять других мест, меняем в одном, автоматически меняется в остальных. 

Синтаксис заимствований в AsciiDoc крайне простой: `include::forget-me-not.adoc`, где `forget-me-not.adoc` - файл, который нужно включить.

Дополнительно можно усложнить заимствование при помощи атрибута:

```
:flower: forget-me-not
include::{flower}.adoc
```

```
:flower: rose
include::{flower}.adoc
```

В AsciiDoc ближайшие к заимствованию атрибуты переопределяют глобальные. То есть, если определить атрибут прямо перед директивой включения, этот атрибут будет применён только к заимствованному содержимому.  В примерах выше заимствования включают разные страницы в зависимости от определённого атрибута: `forget-me-not.adoc` или `rose.adoc`.

## Тэги

Но бывает, что создавать отдельный файл на каждый повторно используемый фрагмент неудобно или просто лень. В таких случаях можно создать один большой файл и использовать тэги.

```
// tag::forget-me-not[]
// end::forget-me-not[]
```

А потом заимствовать только нужный тег через `include::flowers.adoc[tags=forget-me-not]`

Разницы по сравнению с использованием атрибута почти нет, но можно использовать ещё одну хитрость. Например, можно не задавать конкретное имя файла, который мы включаем, а добавить его в атрибут: 

```
include::{flower}.adoc[tags=power]

include::{flower}.adoc[tags=weakness]
```

Можно абстрагироваться ещё больше и использовать атрибуты для тэгов:

```
:flower: forget-me-not
:trait: power
include::{flower}.adoc[tags={trait}]

:flower: rose
:trait: weakness
include::{flower}.adoc[tags={trait}]
```

С атрибутами и тэгами в такой конфигурации можно играть по-разному и в результате указать на большое количество разных блоков заимствуемого содержимого.

## Профилирование

В AsciiDoc есть возможность тонкой настройки профилирования при помощи директив `ifdef` или `ifndef`. Директива `ifdef` включает содержимое, если условие соблюдается, директива `ifndef` включает содержимое, если условие не соблюдается. Условия устанавливаются при помощи атрибутов. Работает это так:

```
ifdef::red[]
Роза
endif::[]
```

В примере выше, если атрибут `:red:` определён, слово "Роза" будет отображено, если не определён - не будет.

Аналогичным образом работает директива `ifndef`, если на странице определён атрибут `:red:`, слово "Роза" не будет включено.

```
ifndef::red[]
Роза
endif::[]
```

Усложним пример, добавим заимствование. Если атрибут `:red:` определён, будет включена страница про розы:

```
ifdef::red[]
include::rose.adoc[]
endif::[]
```

Если атрибут `:red:` не определён, будет включена страница про незабудки:

```
ifndef::red[]
include::forget-me-not.adoc[]
endif::[]
```

Дополнительно можно применить заимствование по тэгам. Если атрибут `:red:` определён, со страницы `flowers.adoc` будет заимствован фрагмент, отмеченный тэгом "rose":

```
ifdef::red[]
include::flowers.adoc[tags=rose]
endif::[]
```

Если атрибут `:red:` отсутствует, будет заимствован фрагмент про незабудки:

```
ifndef::red[]
include::flowers.adoc[tags=forget-me-not]
endif::[]
```

Дополнительный круг сложности можно создать с помощью атрибутов:

```
ifdef::red[]
include::{flower}.adoc[tags={trait}]
endif::[]
```

Нужные атрибуты можно определять на странице, непосредственно перед заимствованием, в блоке, ограниченном четырьмя и более знаками равенства `====`. А использование AsciiDoc в связке с Antora позволит настраивать атрибуты ещё точнее.

## Сворачивающиеся блоки

AsciiDoc из коробки предлагает простой инструмент для создания сворачивающихся блоков. Достаточно обозначить блок сворачиваемым, добавив перед ним `[%collapsible]`.

```
[%collapsible]
====
Роза
====
```

По аналогии с предыдущими примерами можно постепенно усложнять синтаксис и в результате получить внушительной сложности конструкцию:

```
[%collapsible]
====
ifdef::red[]
include::{flower}.adoc[tags={trait}]
endif::[]
====
```

## Заключение

AsciiDoc - сильный инструмент для работы с технической документацией, имеющий синтаксис сходный с Markdown. AsciiDoc предлагает широкий набор функций и определённо стоит того, чтобы к нему присмотреться. 

Подписывайтесь на [мой телеграм](https://t.me/atgiwroc).

Каким инструментом для подготовки документации пользуетесь вы?
